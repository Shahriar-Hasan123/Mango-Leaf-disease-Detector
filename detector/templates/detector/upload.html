{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mango Leaf Disease Detection</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'detector/css/style.css' %}">
</head>
<body>

<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="card shadow upload-area p-4 w-100" style="max-width:640px;">
        <h3 class="mb-4 text-center">Mango Leaf Disease Detection</h3>

        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" id="upload-form">
            {% csrf_token %}
            <label for="image-input" class="d-block mb-2 fw-semibold">Choose image</label>

            <div id="drop-zone" class="border border-dashed p-4 text-center mb-3 bg-white">
                <p class="mb-2 text-muted">Drag & drop an image here, or click to select</p>
                <button type="button" class="btn btn-outline-secondary" id="choose-btn">Select image</button>
                <input id="image-input" type="file" name="image" accept="image/*" class="d-none" required>
                <div id="preview" class="mt-3"></div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Predict Disease</button>
            </div>
        </form>

        <div class="mt-3 text-center text-muted small">
            Recommended: clear leaf photos on plain background (jpg/png).
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const chooseBtn = document.getElementById('choose-btn');
const imageInput = document.getElementById('image-input');
const dropZone = document.getElementById('drop-zone');
const preview = document.getElementById('preview');

chooseBtn.addEventListener('click', () => imageInput.click());

imageInput.addEventListener('change', () => showPreview(imageInput.files[0]));

dropZone.addEventListener('drop', e => {
    e.preventDefault();
    const f = e.dataTransfer.files[0];
    if(f){ imageInput.files = e.dataTransfer.files; showPreview(f); }
});
['dragenter','dragover'].forEach(ev => dropZone.addEventListener(ev,e=>e.preventDefault()));
['dragleave'].forEach(ev => dropZone.addEventListener(ev,e=>e.preventDefault()));

function showPreview(file){
    if(!file){ preview.innerHTML=''; return; }
    const reader = new FileReader();
    reader.onload = e => preview.innerHTML = `<img src="${e.target.result}" class="img-fluid rounded" style="max-width:280px;">`;
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
